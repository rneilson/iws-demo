<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<link rel="stylesheet" type="text/css" href="webview.css">
		<link rel="canonical" href="">
		<link rel="alternate" type="application/rss+xml" title="" href="">
		<script type="text/javascript" src="angular.min.js"></script>
		<script type="text/javascript" src="webview.js"></script>
		<title>IWS Demo Webview</title>
	</head>
	<body ng-app="iws-webview">
		<div id="outer" class="noborder nopadding">
			<div id="header" class="header" ng-controller="HeaderController as hdcon">
				<div class="nopadding noborder topleft"><h1>IWS Demo</h1></div>
				<div class="nopadding noborder topright">
					<span ng-class="{hidden: !hdcon.auth.logged_in}">
						<strong>{{hdcon.auth.full_name}}</strong> / <a ng-click="hdcon.logout()">Log out</a>
					</span>
				</div>
				<div class="footer"></div>
			</div>
			<div id="main" class="noborder nopadding" ng-controller="ClientListController as clcon">
				<div id="sidebar" class="leftside nopadding noborder" ng-if="clcon.logged_in">
					<div id="clientlist" class="nopadding noborder">
						<div class="header perchheader">Client list</div>
						<div class="clienttable">
							<table>
								<colgroup>
									<col class="clientname"></col>
									<col class="count"></col>
									<col class="count"></col>
								</colgroup>
								<thead>
									<tr>
										<th>Name</th><th>Open</th><th>Closed</th>
									</tr>
								</thead>
								<tbody>
									<tr ng-class="{selected: cli.id == clcon.clients.id}" ng-repeat="cli in clcon.clients.list" ng-click="clcon.selectclient(cli.id)">
										<td>{{cli.name}}</td><td>{{cli.open_count}}</td><td>{{cli.closed_count}}</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div id="clientdetails" ng-controller="ClientDetailController as cdcon" ng-class="{hidden: !cdcon.client.id}">
						<div class="noborder nopadding" ng-class="{hidden: cdcon.edit_mode}">
							<p><span class="sectitle">{{cdcon.client.name}}</span></p>
							<p>Contact name:<br/>{{cdcon.client.con_name}}</p>
							<p>Contact email:<br/><a href="mailto:{{cdcon.client.con_mail}}">{{cdcon.client.con_mail}}</a></p>
							<p>Date added: {{cdcon.client.date_add | date:'EEE dd MMM yy'}}</p>
							<div class="button-row">
								<input ng-click="cdcon.edit('update')" type="button" value="Edit" />
								<input ng-click="cdcon.edit('create')" type="button" value="New" />
							</div>
						</div>
						<div class="noborder nopadding" ng-if="cdcon.edit_mode">
							<form name="cdcon.edit_form" novalidate>
								<div class="form-row">
									<label>Client name: <span class="error" ng-class="{hidden: !cdcon.edit_form.name.$error.required}">Required</span><br/>
									<input ng-model="cdcon.edit_cli.name" name="name" type="text" required /></label>
								</div>
								<div class="form-row">
									<label>Contact name:<br/>
									<input ng-model="cdcon.edit_cli.con_name" name="con_name" type="text" /></label>
								</div>
								<div class="form-row">
									<label>Contact email: <span class="error" ng-class="{hidden: !cdcon.edit_form.con_mail.$error.email}">Invalid</span><br/>
									<input ng-model="cdcon.edit_cli.con_mail" name="con_mail" type="email" /></label>
								</div>
								<div class="button-row">
									<input ng-click="cdcon.save()" type="button" value="Save" />
									<input ng-click="cdcon.close()" type="button" value="Cancel" />
								</div>
								<div class="noborder" ng-class="{hidden: !cdcon.edit_msg}">{{cdcon.edit_msg}}</div>
								<div class="noborder" ng-class="{hidden: !cdcon.edit_err}"><span class="error">{{cdcon.edit_err}}</span></div>
							</form>
						</div>
					</div>
				</div>
				<div id="container" class="rightside" ng-controller="ReqListController as rlcon" ng-if="clcon.logged_in">
					<div id="nav">
						<button class="tabnav" type="button" ng-class="{selected: rlcon.tab=='open'}" ng-click="rlcon.selecttab('open')">Open requests
						</button><button class="tabnav" type="button" ng-class="{selected: rlcon.tab=='closed'}" ng-click="rlcon.selecttab('closed')">Closed requests</button>
					</div>
					<div id="clientopen" class="panel" ng-class="{open: rlcon.tab == 'open'}">
						<table>
							<thead>
								<tr>
									<th class="short">Priority</th>
									<th class="reqtitle">Title</th>
									<th class="short">Area</th>
									<th class="date">Target Date</th>
									<th class="date">Opened On</th>
									<th class="user">Opened By</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="oreq in rlcon.client.open_list" ng-class="{selected: oreq.req.id == rlcon.req.open}" ng-click="rlcon.selectreq(oreq.req.id)">
									<td class="short">{{oreq.priority}}</td>
									<td class="reqtitle">{{oreq.req.title}}</td>
									<td class="short">{{oreq.req.prod_area}}</td>
									<td class="date">{{oreq.date_tgt | date:'EEE dd MMM yy'}}</td>
									<td class="date">{{oreq.opened_at | date:'EEE dd MMM yy'}}</td>
									<td class="user">{{oreq.opened_by}}</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="clientclosed" class="panel" ng-class="{open: rlcon.tab == 'closed'}">
						<table>
							<thead>
								<tr>
									<th class="short">Status</th>
									<th class="reqtitle">Title</th>
									<th class="short">Area</th>
									<th class="date">Target Date</th>
									<th class="date">Closed On</th>
									<th class="user">Closed By</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="creq in rlcon.client.closed_list" ng-class="{selected: creq.req.id == rlcon.req.closed}" ng-click="rlcon.selectreq(creq.req.id)">
									<td class="short">{{creq.status}}</td>
									<td class="reqtitle">{{creq.req.title}}</td>
									<td class="short">{{creq.req.prod_area}}</td>
									<td class="date">{{creq.date_tgt | date:'EEE dd MMM yy'}}</td>
									<td class="date">{{creq.closed_at | date:'EEE dd MMM yy'}}</td>
									<td class="user">{{creq.closed_by}}</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="reqdetails" ng-controller="ReqDetailController as rdcon">
						<div id="reqnew" ng-class="{hidden: ((rdcon.detail.req.id) || (rdcon.edit_mode == 'create'))}">
							<div class="button-row">
								<input ng-click="rdcon.edit('create')" type="button" value="New" />
							</div>
						</div>
						<div id="reqdata" class="noborder" ng-form name="rdcon.edit_form" ng-class="{hidden: ((!rdcon.detail.req.id) && (rdcon.edit_mode != 'create'))}">
							<div class="noborder">
								<span class="sectitle" ng-class="{hidden: (rdcon.edit_mode)}">{{rdcon.detail.req.title}}</span>
								<div class="oreq-row" ng-if="rdcon.edit_mode">
									<div class="req-title">Title:
									</div><div class="req-text"><input type="text" name="title" ng-model="rdcon.edit_req.title" required /></div>
								</div>
							</div>
							<div class="oreq">
								<div class="oreq-row">
									Product Area: <span ng-class="{hidden: rdcon.edit_mode}"><strong>{{rdcon.detail.req.prod_area}}</strong>
									</span><span ng-if="rdcon.edit_mode"><select ng-options="area for area in rdcon.areas" ng-model="rdcon.edit_req.prod_area" name="prod_area" required></select></span>
								</div>
								<div class="oreq-row">
									<div class="req-title">URL: </div><div class="req-text"><span ng-class="{hidden: rdcon.edit_mode}">
									<a href="{{rdcon.detail.req.ref_url}}">{{rdcon.detail.req.ref_url}}</a>
									</span><span ng-if="rdcon.edit_mode"><input type="url" name="ref_url" ng-model="rdcon.edit_req.ref_url" /></span></div>
								</div>
							</div>
							<div class="oreq">
								Description:<br/>
								<pre class="desc" ng-class="{hidden: (rdcon.edit_mode == 'create')}">{{rdcon.detail.req.desc}}</pre>
								<textarea ng-if="rdcon.edit_mode" name="desc" ng-model="rdcon.edit_req.desc"></textarea>
							</div>
							<div class="button-row" ng-class="{hidden: (rdcon.edit_mode || !rdcon.detail.open.length)}">
								<input ng-click="rdcon.edit('update')" type="button" value="Edit" />
								<input ng-click="rdcon.edit('create')" type="button" value="New" />
							</div>
							<div class="button-row" ng-if="rdcon.edit_mode">
								<input ng-click="rdcon.save()" type="button" value="Save" />
								<input ng-click="rdcon.close()" type="button" value="Cancel" />
								<div class="noborder" ng-class="{hidden: !rdcon.edit_msg}">{{rdcon.edit_msg}}</div>
								<div class="noborder" ng-class="{hidden: !rdcon.edit_err}"><span class="error">{{rdcon.edit_err}}</span></div>
							</div>
						</div><div id="reqlists" class="noborder">
							<div id="reqopen" class="noborder nopadding" ng-if="rdcon.detail.open.length" ng-class="{hidden: (rdcon.edit_mode == 'create')}">
								<div class="noborder"><span class="sectitle">Open</span></div>
								<div class="oreq" ng-repeat="oreq in rdcon.detail.open"	ng-controller="OpenReqController as orcon" 
								ng-init="orcon.setup(oreq)">
									<div class="oreq-row">
										<div class="oreq-name">{{rdcon.getclientname(oreq.client_id)}}
										</div><div class="oreq-con" ng-class="{hidden: (orcon.edit_mode || orcon.edit_msg)}"><input type="button" ng-click="orcon.edit('update')" value="Edit"/> <input type="button" ng-click="orcon.edit('close')" value="Close"/>
										</div><div class="oreq-con" ng-class="{hidden: (!orcon.edit_mode || orcon.edit_msg)}"><input type="button" ng-click="orcon.save()" value="Save"/> <input type="button" ng-click="orcon.close()" value="Cancel"/>
										</div><div class="oreq-con" ng-class="{hidden: !orcon.edit_msg}">{{orcon.edit_msg}}</div>
									</div>
									<div class="oreq-row" ng-class="{hidden: (orcon.edit_mode)}">
										<div class="oreq-pri">Priority: <span><strong>{{orcon.oreq.priority || 'None'}}</strong></span>
										</div><div class="oreq-date">Target date:<span class="textright">
										{{(orcon.oreq.date_tgt | date:'EEE dd MMM yy') || 'None'}}</span></div>
									</div>
									<div class="oreq-form" ng-if="orcon.edit_mode == 'update'" ng-form name="orcon.edit_form">
										<input type="number" min="0" max="32766" ng-model="orcon.edit_oreq.priority" name="priority" /><input type="date" min="{{orcon.today | date:'yyyy-MM-dd'}}" ng-model="orcon.edit_oreq.date_tgt" name="date_tgt" />
									</div>
									<div class="oreq-form" ng-if="orcon.edit_mode == 'close'" ng-form name="orcon.edit_form">
										<input type="text" ng-model="orcon.edit_oreq.reason" name="reason" required />
										<span class="textright"><select ng-options="status for status in orcon.status_list" ng-model="orcon.edit_oreq.status" name="status" required></select></span>
									</div>
									<div class="noborder nopadding" ng-class="{hidden: !orcon.edit_err}"><span class="error">{{orcon.edit_err}}</span></div>
								</div>
							</div>
							<div id="reqopennew" class="noborder nopadding" ng-if="rdcon.edit_mode == 'create'">
								<div class="noborder">
									<span>{{rdcon.getclientname(rdcon.edit_oreq.client_id)}}</span>
								</div>
								<div class="noborder">
									<div class="oreq-row">
										<div class="oreq-pri">Priority:</div><div class="oreq-date">Target date:</div>
									</div>
									<div class="oreq-form" ng-form name="rdcon.edit_form">
										<input type="number" min="0" max="32766" ng-model="rdcon.edit_oreq.priority" name="priority" /><input type="date" min="{{rdcon.today | date:'yyyy-MM-dd'}}" ng-model="rdcon.edit_oreq.date_tgt" name="date_tgt" />
									</div>
								</div>
							</div>
							<div id="reqclosed" class="noborder nopadding" ng-if="rdcon.detail.closed.length" ng-class="{hidden: (rdcon.edit_mode == 'create')}">
								<div class="noborder"><span class="sectitle">Closed</span></div>
								<div class="oreq" ng-repeat="creq in rdcon.detail.closed">
									<div class="oreq-row">
										<div class="oreq-name">{{rdcon.getclientname(creq.client_id)}}
										</div><div class="oreq-con"><strong>{{creq.status}}</strong></div>
									</div>
									<div class="oreq-row"><pre class="reason">{{creq.reason}}</pre></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="footer", class="footer"></div>
			</div>
			<div id="login" ng-class="{hidden: lgcon.auth.logged_in}" ng-controller="LoginController as lgcon">
				<div id="login-msg" class="header">
					{{lgcon.login_msg}}
				</div>
				<div id="login-form" ng-class="{hidden: !lgcon.login_req}">
					<form name="lgcon.login_form" novalidate>
						<div class="form-row">
						  <label for="id_username">Username:
						  </label><input id="id_username" maxlength="254" name="username" type="text" ng-model="lgcon.username" required/>
						</div>
						<div class="form-row">
						  <label for="id_password">Password:
						  </label><input id="id_password" name="password" type="password" ng-model="lgcon.password" required/>
						</div>
						<div class="submit-row">
							<input type="submit" value="Log in" ng-click="lgcon.login()"/>
						</div>
					</form>
				</div>
			</div>
		</div>
	</body>
</html>
